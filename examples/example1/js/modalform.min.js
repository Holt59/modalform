!function(t){"use strict";function o(t,o){var i=this;this.dialog=t,this.form=this.dialog.find("form"),this.options=o,this.dialog.modal({backdrop:"static",keyboard:!1,show:!1}),this.dialog.on("hidden.bs.modal",function(){i.options.onHide()}),this.form.submit(function(){return i.submit(),!1}),this.form.find("input").on("keypress",function(t){13==t.which&&(t.preventDefault(),i.submit())}),this.dialog.find('*[data-submit="modal-form"]').on("click",function(){i.submit()}),this.dialog.find('*[data-reset="modal-form"]').on("click",function(){i.clear()})}o.prototype={constructor:o,isChecked:function(t){return void 0!==t&&0!==parseInt(t)&&t!==!1&&0!==t.length},clear:function(o){var i=this;"undefined"==typeof o&&(o=!0),this.form.find("input:not(.no-modalform), select:not(.no-modalform), textarea").each(function(){var e=i.options.getFieldName(t(this).attr("name"));"checkbox"==t(this).attr("type")?i.isChecked(i.options.defaultValues[e])?t(this).prop("checked",!0):t(this).prop("checked",!1):("file"!=t(this).attr("type")||o)&&t(this).val(i.options.defaultValues[e]),t(this).change(),i.removeError(t(this))})},setValues:function(o,i){var e=this;this.clear(i),this.form.find("input:not(.no-modalform), select:not(.no-modalform), textarea").each(function(){var i=e.options.getFieldName(t(this).attr("name"));"checkbox"==t(this).attr("type")?e.isChecked(o[i])?t(this).prop("checked",!0):t(this).prop("checked",!1):"file"==t(this).attr("type")||t(this).val(e.options.dataToInput(i,o[i],t(this),o)),t(this).change()})},getValues:function(){var o=this,i=new FormData;return this.form.find("input:not(.no-modalform), select:not(.no-modalform), textarea").each(function(){var e=o.options.getFieldName(t(this).attr("name"));"checkbox"==t(this).attr("type")?i.append(t(this).attr("name"),t(this).is(":checked")?1:0):"file"==t(this).attr("type")?t(this).prop("files").length>0&&i.append(t(this).attr("name"),t(this).prop("files")[0]):i.append(t(this).attr("name"),o.options.inputToData(e,t(this).val(),t(this)))}),i},update:function(o,i){var e=this;this.setValues(o,!1),this.form.find("input:not(.no-modalform), select:not(.no-modalform)").each(function(){var o=e.options.getFieldName(t(this).attr("name"));i[o]?e.addError(t(this),i[o]):e.removeError(t(this))})},startSpinner:function(){this.dialog.find('*[data-submit="modal-form"]').spinner({style:"zoom-in"}).spinner("start")},stopSpinner:function(){this.dialog.find('*[data-submit="modal-form"]').spinner("stop")},submit:function(){this.startSpinner(),t.ajax({type:"post",url:this.form.attr("action"),data:this.getValues(),context:this,processData:!1,contentType:!1,success:function(t){this.stopSpinner(),this.update(t.values,t.errors),0===t.errors.length?this.options.success(t.values):this.options.fail(t.values,t.errors),this.form.find("input, select").blur()},complete:function(){this.stopSpinner()},dataType:"json"})},show:function(o){"undefined"!=typeof o&&this.dialog.find(".modal-header h4").html(o),this.dialog.modal("show"),this.dialog.on("shown",function(){t(this).find(".modal-body").scrollTop(0)}),this.options.onShow(),this.dialog.on("shown",function(){t(this).find("form").find("input:visible, select:visible").first().focus()})},hide:function(){this.dialog.modal("hide")},addError:function(o,i){if(!t(this).is(":hidden")){this.removeError(o);var e=t('<span class="help-block modalform-error">'+i[0]+"</span>"),s=parseInt(o.parents('*[class^="col-md-"]:first').attr("class").match(/col-md-([0-9]+)/)[1]);e.addClass("col-md-offset-"+(12-s)),e.addClass("col-md-"+s),o.parents(".form-group").append(e),o.parents(".form-group").addClass("has-error")}},removeError:function(t){t.parents(".form-group").find(".modalform-error").remove(),t.parents(".form-group").removeClass("has-error")},setError:function(t,o){o===!1?this.removeError(t):this.addError(t,[o])}},t.fn.modalform=function(i){var e=arguments;return this.each(function(){if(t.isPlainObject(i))this.modalform=new o(t(this),t.extend({},t.fn.modalform.defaults,i));else if("string"==typeof i)switch(i){case"show":this.modalform.show(e[1]);break;case"hide":this.modalform.hide();break;case"error":this.modalform.setError(e[1],e[2]);break;case"clear":this.modalform.clear();break;case"setValues":this.modalform.setValues(e[1])}})},t.fn.modalform.defaults={defaultValues:[],success:function(){},fail:function(){},onShow:function(){},onHide:function(){},inputToData:function(t,o){return o},dataToInput:function(t,o){return o},getFieldName:function(t){return t}}}(jQuery);